!function(){"use strict";var liveTimer=function($,window,moment){function timerValues(deltaSec,style){var primaryTime,primaryUnits,secondaryTime,secondaryUnits,text,fullText,updateInterval;if(60>deltaSec)primaryTime=deltaSec,primaryUnits="second",updateInterval=1e3;else if(3600>deltaSec){if(primaryTime=deltaSec/60,primaryUnits="minute",updateInterval=1e3,deltaSec%60!==0)secondaryTime=deltaSec%60,secondaryUnits="second"}else if(86400>deltaSec){if(primaryTime=deltaSec/3600,primaryUnits="hour",updateInterval=6e4,deltaSec%3600!==0)secondaryTime=Math.ceil(deltaSec%3600/60),secondaryUnits="minute"}else if(604800>deltaSec){if(primaryTime=deltaSec/86400,primaryUnits="day",updateInterval=36e5,deltaSec%86400!==0)secondaryTime=Math.ceil(deltaSec%86400/3600),secondaryUnits="hour"}else if(2629740>deltaSec){if(primaryTime=deltaSec/604800,primaryUnits="week",updateInterval=864e5,deltaSec%604800!==0)secondaryTime=Math.ceil(deltaSec%604800/86400),secondaryUnits="day"}else if(primaryTime=deltaSec/2629740,primaryUnits="month",updateInterval=6048e5,deltaSec%2629740!==0)secondaryTime=Math.ceil(deltaSec%2629740/604800),secondaryUnits="week";var primaryUnitKey=primaryUnits,secondaryUnitKey=secondaryUnits;if(primaryTime=Math.floor(primaryTime),1!==primaryTime)primaryUnits+="s";if(secondaryTime&&1!==secondaryTime)secondaryUnits+="s";if(fullText=primaryTime+" "+primaryUnits,secondaryTime&&secondaryUnits)fullText+=", "+secondaryTime+" "+secondaryUnits;if("binary-concise"===style){var UNIT_MAPS={second:{primary:"sec",secondary:"s"},minute:{primary:"min",secondary:"m"},hour:{primary:"hr",secondary:"h"},day:{primary:"day",secondary:"d"},week:{primary:"wk",secondary:"w"},month:{primary:"mon",secondary:"m"},year:{primary:"yr",secondary:"y"}};if(text=primaryTime+UNIT_MAPS[primaryUnitKey].primary,secondaryTime&&secondaryUnits)text+=" "+secondaryTime+UNIT_MAPS[secondaryUnitKey].secondary}else text=fullText;return{text:text,fullText:fullText,updateInterval:updateInterval}}function differenceInSeconds(d1,d2){return Math.ceil(Math.abs(d2-d1)/1e3)}function parseFormatString(formatString,s1,s2){if("undefined"==typeof formatString||null===formatString)return s1;else if("function"==typeof formatString)return formatString.call(null,s1,s2);else return formatString.replace(/%s/,s1).replace(/%s/,s2).replace(/%1\$s/,s1).replace(/%2\$s/,s2)}$.widget("coursera.livetimer",{options:{relative:{pastFormat:"%s ago",futureFormat:"in %s",style:"binary-full"},title:{pastFormat:"%1$s",futureFormat:"%1$s"},cycle:{fx:"fade",containerResize:!1,slideResize:!1},display:"cycle"},dateIsPast:!1,_create:function(){var originalDate=this.getDate();if(isNaN(originalDate))return;if(!this.element.text())this.element.text(originalDate.toLocaleString());if(this.element.attr("data-livetimer-date-original",this.element.text()),!this.element.attr("title"))this.element.data("livetimer-set-title",!0);var html='<span class="livetimer-absolute">'+this.element.html()+"</span>";html+='<span class="livetimer-relative"></span>';var height=this.element.height(),width=this.element.width();this.element.html(html).css({height:height,width:width}),this._update()},_init:function(){if(this.dateIsPast=this.isPast(),"cycle"===this.options.display)this.element.cycle(this.options.cycle);else if("relative"===this.options.display)this.element.children(".livetimer-absolute").hide(),this.element.children(".livetimer-relative").show();else if("absolute"===this.options.display)this.element.children(".livetimer-relative").hide(),this.element.children(".livetimer-absolute").show();else if("absoluteAndRelative"===this.options.display)this.element.children(".livetimer-absolute").show(),this.element.children(".livetimer-relative").show()},_setOption:function(key,value){if("cycleOptions"===key)this.element.cycle(this.options.cycle);if($.Widget.prototype._setOption.apply(this,arguments),"display"===key)this._update()},_update:function(){var that=this,relativeHtml,absoluteHtml,updateInterval,fullRelativeText,absoluteText,titleFormat,currentDate=new Date,absoluteDate=this.getDate();if(isNaN(absoluteDate))relativeHtml=absoluteHtml=this.getFormattedDateString(),updateInterval=1e3,this.element.data("livetimer-set-title",null);else{var relativeFormat=null,absoluteFormat=null;if(currentDate>=absoluteDate){if(this.options.relative)relativeFormat=this.options.relative.pastFormat;if(this.options.absolute)absoluteFormat=this.options.absolute.pastFormat;titleFormat=this.options.title.pastFormat}else{if(this.options.relative)relativeFormat=this.options.relative.futureFormat;if(this.options.absolute)absoluteFormat=this.options.absolute.futureFormat;titleFormat=this.options.title.futureFormat}var values=timerValues(differenceInSeconds(currentDate,absoluteDate),this.options.relative.style),relativeText=values.text;fullRelativeText=values.fullText,absoluteText=this.getFormattedDateString(),relativeHtml=parseFormatString(relativeFormat,relativeText),absoluteHtml=parseFormatString(absoluteFormat,absoluteText),updateInterval=values.updateInterval}if(this.element.children(".livetimer-relative").html(relativeHtml),this.element.children(".livetimer-absolute").html(absoluteHtml),this.element.data("livetimer-set-title"))this.element.attr("title",parseFormatString(titleFormat,absoluteText,fullRelativeText));if(!this.dateIsPast&&currentDate>=absoluteDate)this.dateIsPast=!0,this._trigger("hasPassed");window.setTimeout(function(){that._update(),that._trigger("tick")},updateInterval)},isPast:function(){var currentDate=new Date,absoluteDate=this.getDate();if(isNaN(absoluteDate))return;return currentDate>=absoluteDate},getDateOriginal:function(){return this.element.attr("data-livetimer-date-original")},getDate:function(){var originalDateValue=parseInt(this.element.attr("data-livetimer-date-primitive"),10);return!isNaN(originalDateValue)&&new Date(originalDateValue)},getFormattedDateString:function(){if(this.options.absolute.momentReformat&&moment){var time=this.getDate();return time=moment(time),time.format("function"==typeof this.options.absolute.momentReformat?this.options.absolute.momentReformat.call(time):this.options.absolute.momentReformat)}else return this.getDateOriginal()},destroy:function(){this.element.html(this.element.children(".livetimer-absolute").html()),$.Widget.prototype.destroy.call(this)}})};if("function"==typeof define&&define.amd)define(["jquery","js/lib/jquery.ui.widget"],function($,dummy_widget,moment){return liveTimer($,window,moment)});else liveTimer(jQuery,window,window.moment)}();